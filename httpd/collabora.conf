<VirtualHost *:443>
    ServerName collabora.tribu.local

    SSLEngine on

    # Container uses a unique non-signed certificate
    SSLProxyEngine On
    SSLProxyVerify None
    SSLProxyCheckPeerCN Off
    SSLProxyCheckPeerName Off

    SSLCertificateFile /etc/ssl/certs/server-collabora.crt
    SSLCertificateKeyFile /etc/ssl/certs/server-collabora.key

    # Encoded slashes need to be allowed
    AllowEncodedSlashes NoDecode

    # keep the host
    ProxyPreserveHost On

    # static html, js, images, etc. served from coolwsd
    # browser is the client part of LibreOffice Online
    ProxyPass           /browser https://collabora:9980/browser retry=0
    ProxyPassReverse    /browser https://collabora:9980/browser

    # WOPI discovery URL
    ProxyPass           /hosting/discovery https://collabora:9980/hosting/discovery retry=0
    ProxyPassReverse    /hosting/discovery https://collabora:9980/hosting/discovery

    # Main websocket
    ProxyPassMatch "/cool/(.*)/ws$" wss://collabora:9980/cool/$1/ws nocanon

    # Admin Console websocket
    ProxyPass   /cool/adminws wss://collabora:9980/cool/adminws

    # Download as, Fullscreen presentation and Image upload operations
    ProxyPass           /cool https://collabora:9980/cool
    ProxyPassReverse    /cool https://collabora:9980/cool

    # Endpoint with information about availability of various features
    ProxyPass           /hosting/capabilities https://collabora:9980/hosting/capabilities retry=0
    ProxyPassReverse    /hosting/capabilities https://collabora:9980/hosting/capabilities

    Header add Access-Control-Allow-Origin "*"

</VirtualHost>
