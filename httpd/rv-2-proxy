    ## =============
    ## Reverse-proxy settings
    ProxyPreserveHost On
    RewriteEngine On
    RewriteOptions Inherit

    DirectoryIndex /portail    

    ProxyPass      /portail                         balancer://clusterportal/portail stickysession=ROUTEID nofailover=On
    ProxyPassMatch ^/(.+)/(.*)-adapt-.*\.(css|js)$  balancer://clusterportal/$1/$2.$3 stickysession=ROUTEID nofailover=On
    ProxyPassMatch ^/(portal(-[a-z])+.*)$           balancer://clusterportal/$1 stickysession=ROUTEID nofailover=On
    ProxyPassMatch ^/(osivia(-[a-z])+.*)$           balancer://clusterportal/$1 stickysession=ROUTEID nofailover=On
    ProxyPassMatch ^/(toutatice(-[a-z])+.*)$        balancer://clusterportal/$1 stickysession=ROUTEID nofailover=On    
    ProxyPassMatch ^/(elen(-[a-z])+.*)$             balancer://clusterportal/$1 stickysession=ROUTEID nofailover=On

    ProxyPass /nuxeo http://NUXEO_HOST:8080/nuxeo
    ProxyPassReverse /nuxeo  http://NUXEO_HOST:8080/nuxeo
    
    ProxyPass /cas http://CAS_HOST:8080/cas
    ProxyPassReverse /cas  http://CAS_HOST:8080/cas
    
    ProxyPass /pad http://PAD_HOST:9001
    ProxyPassReverse /pad http://PAD_HOST:9001
    
    ProxyPass /fakesmtp http://WEBMAIL_HOST:8080
    ProxyPassReverse /fakesmtp http://WEBMAIL_HOST:8080
    ProxyPass /ui http://WEBMAIL_HOST:8080/ui
    ProxyPassReverse /ui http://WEBMAIL_HOST:8080/ui
    
    ProxyPassMatch ^\/onlyoffice(.*)(\/websocket)$ "ws://OO_HOST$1$2"
    ProxyPass /onlyoffice "http://OO_HOST"
    ProxyPassReverse /onlyoffice "http://OO_HOST"
    ## End of reverse-proxy settings
    
    ## =============
    ## Tuning headers for HTTPS
    SetEnvIf Host (.*) the_host=$1
    RequestHeader set osivia-virtual-host "https://%{the_host}e"
    RequestHeader set nuxeo-virtual-host "https://%{the_host}e/"
    RequestHeader set X-Forwarded-Proto "https"
    ## End of reverse-proxy settings
    
    ## Specific headers for onlyoffice
    <Location /onlyoffice>
    
        Require all granted
        SetEnvIf Host "^(.*)$" THE_HOST=$1
    
        # Si pas de proto, ajout https par défaut
        SetEnvIf X-Forwarded-Proto ^$ no_proto
        RequestHeader set X-Forwarded-Proto https env=no_proto
    
        # Si pas de host, ajout du host appelant  par défaut
        SetEnvIf X-Forwarded-Host ^$ no_host
        RequestHeader set X-Forwarded-Host %{THE_HOST}e env=no_host
    
        # Ajout location après url du host
        RequestHeader edit X-Forwarded-Host (.*) $1/onlyoffice
        ProxyAddHeaders Off
    </Location>
    ## End of headers tuning
    

</VirtualHost>
## End of virtual host
